/*
 * Copyright Amadeus
 */
Aria.classDefinition({$classpath:"aria.modules.queuing.AriaSyncSessionQueuing",$dependencies:["aria.utils.Function","aria.modules.RequestMgr"],$constructor:function(){this._idSessionMap={};this._sessionQueues={};this._mixedModeCheck=false},$statics:{NO_SESSION_ID_KEY:"1"},$destructor:function(){this._sessionQueues=this._idSessionMap=null;this.handleNextRequest=function(){}},$prototype:{pushRequest:function(a,d,c){var b,e=a.session.id,f=Aria.$window.a;if(!this._mixedModeCheck)if(typeof f=="undefined"||
!f.actionQueueImpl||!f.actionQueueImpl.lockQueue)this.$logError("Mixed Mode with Aria is not Enabled");else this._mixedModeCheck=true;if(!e)e=this.NO_SESSION_ID_KEY;b=this._getQueue(e);if(b.length>0){b.push({requestObject:a,jsonData:d,cb:c});return aria.modules.RequestMgr.QUEUE_STATUS}else if(f.actionQueueImpl.isSsaAvailable(null,e)){a=this._sendRequest(a,d,c);if(a===aria.modules.RequestMgr.ERROR_STATUS)return a;else{f.actionQueueImpl.lockQueue(e);this._idSessionMap[a]=e;b.push(a);return aria.modules.RequestMgr.EXECUTE_STATUS}}else{b.length==
0&&f.actionQueueImpl.setExternalHandler(aria.utils.Function.bind(this.__handleQueue,this,e),e);b.push({requestObject:a,jsonData:d,cb:c});return aria.modules.RequestMgr.QUEUE_STATUS}},handleNextRequest:function(a){if(this._idSessionMap){var d=this._idSessionMap[a];if(d){delete this._idSessionMap[a];if(this.__handleQueue(d,a)){a=Aria.$window.a;a.actionQueueImpl.setExternalHandler(null,d);a.actionQueueImpl.unLockQueue(d)}}}},__handleQueue:function(a,d){var c,b=this._getQueue(a);if(d){this.$assert(135,
b&&b.length>0);this.$assert(136,b[0]===d);b.splice(0,1)}for(;b.length>0;){c=b[0];c=this._sendRequest(c.requestObject,c.jsonData,c.cb);if(c===aria.modules.RequestMgr.ERROR_STATUS)b.splice(0,1);else{this._idSessionMap[c]=a;b[0]=c;break}}return!b.length},_sendRequest:function(a,d,c){return aria.modules.RequestMgr.sendJsonRequest(a,d,c)},_getQueue:function(a){this._sessionQueues[a]||(this._sessionQueues[a]=[]);return this._sessionQueues[a]}}});